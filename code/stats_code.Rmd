---
title: "stats_code"
author: "Aimee"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(knitr)  
setwd("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data")
```

#Survival rate
```{r}
survival <- read_excel("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data/survival.xlsx")

survival$Treatment <- paste0(substr(survival$Diet, 1, 1), substr(survival$Temperature, 1, 1))

survival <- survival %>%
  mutate(across(everything(), ~ifelse(is.na(.), 0, .)))

survival <- survival %>% group_by(Tank) %>% mutate(CumMort= cumsum(Mortalities), CumMorb = cumsum(Morbidities))

survival <-survival %>% group_by(Tank) %>% mutate(survival_rate = 100*( (19-CumMort)/19))

survival$Temperature <- as.factor(survival$Temperature)


```

Check normality and homoscedasticity

For Shapiro: If p < 0.05, we can be 95% certain that the 
data are not normally distributed. 

For Levene: If p < 0.05, the treatment group data does not have equal variances
```{r}

week1_survival <- survival%>% filter(Week == 1)
week9_survival <- survival%>% filter(Week == 9)
week10_survival <- survival%>% filter(Week == 10)
week18_survival <- survival%>% filter(Week == 18)
week24_survival <- survival%>% filter(Week == 24)

#normality tests
shapiro.test(week9_survival$survival_rate) # not normal
shapiro.test(week10_survival$survival_rate) # not normal
shapiro.test(week18_survival$survival_rate) # not normal
shapiro.test(week24_survival$survival_rate) # not normal

#homogeneity tests
require("car")

leveneTest(week9_survival$survival_rate~week9_survival$Treatment) # not equal
leveneTest(week9_survival$survival_rate~week9_survival$Diet) # not equal

leveneTest(week10_survival$survival_rate~week10_survival$Treatment) # equal
leveneTest(week10_survival$survival_rate~week10_survival$Diet) # equal

leveneTest(week18_survival$survival_rate~week18_survival$Treatment) # equal
leveneTest(week18_survival$survival_rate~week18_survival$Diet) # equal

leveneTest(week24_survival$survival_rate~week24_survival$Treatment) # equal
leveneTest(week24_survival$survival_rate~week24_survival$Diet) # equal



final_survival <- survival %>% filter(Week == 24)
week4_survival <- survival%>% filter(Week == 4)
week9_survival <- survival%>% filter(Week == 9)
week8_survival <- survival%>% filter(Week == 8)
week13_survival <- survival%>% filter(Week == 13)
week18_survival <- survival%>% filter(Week == 18)
week23_survival <- survival%>% filter(Week == 23)
week16_survival <- survival%>% filter(Week == 16)
week14_survival <- survival%>% filter(Week == 14)

shapiro.test(week4_survival$survival_rate) # not normal

shapiro.test(week9_survival$survival_rate) #not normal

shapiro.test(week8_survival$survival_rate) #not normal

shapiro.test(week13_survival$survival_rate) # not normal

shapiro.test(week18_survival$survival_rate) # not normal

shapiro.test(week23_survival$survival_rate) # not normal

shapiro.test(final_survival$survival_rate) #not normal


shapiro.test(survival$survival_rate) #not normal


require("car")

leveneTest(week9_survival$survival_rate~week9_survival$Treatment) # not equal
         
leveneTest(week8_survival$survival_rate~week8_survival$Treatment) # equal

leveneTest(week8_survival$survival_rate~week8_survival$Diet) # equal

leveneTest(final_survival$survival_rate~final_survival$Treatment) #equal
        

```


Tests for significance
```{r}
#install.packages("dunn.test", dependencies = TRUE)
require("dunn.test")
#install.packages("coin", dependencies = TRUE)
require(coin)

#week9
kruskal.test(survival_rate ~ Diet, data = week9_survival) #sig
kruskal.test(survival_rate ~ Temperature, data = week9_survival) #not sig
kruskal.test(survival_rate ~ Treatment, data = week9_survival) #sig

U = wilcox_test(survival_rate~Temperature, data = week9_survival, 
                 alternative = "two.sided") #ns
U


dunn.test(week9_survival$survival_rate, g = week9_survival$Diet, altp = TRUE, method = "bonferroni")
dunn.test(week9_survival$survival_rate, g = week9_survival$Treatment, altp = TRUE, method = "bonferroni")

#week10
kruskal.test(survival_rate ~ Diet, data = week10_survival) #not sig
kruskal.test(survival_rate ~ Temperature, data = week10_survival) #sig
kruskal.test(survival_rate ~ Treatment, data = week10_survival) #not sig

dunn.test(week10_survival$survival_rate, g = week10_survival$Temperature, altp = TRUE, method = "bonferroni")

U = wilcox_test(survival_rate~Temperature, data = week10_survival, 
                 alternative = "two.sided")
U

U = wilcox_test(survival_rate~Temperature, data = week10_survival, 
                 alternative = "less")
U

#week18
kruskal.test(survival_rate ~ Diet, data = week18_survival) #not sig
kruskal.test(survival_rate ~ Temperature, data = week18_survival) #sig
kruskal.test(survival_rate ~ Treatment, data = week18_survival) #not sig

dunn.test(week10_survival$survival_rate, g = week10_survival$Diet, altp = TRUE)

U = wilcox_test(survival_rate~Temperature, data = week18_survival, 
                 alternative = "two.sided")
U

U = wilcox_test(survival_rate~Temperature, data = week18_survival, 
                 alternative = "less")
U

#week24
kruskal.test(survival_rate ~ Diet, data = week24_survival) #not sig
kruskal.test(survival_rate ~ Temperature, data = week24_survival) #sig
kruskal.test(survival_rate ~ Treatment, data = week24_survival) #not sig

U = wilcox_test(survival_rate~Temperature, data = week24_survival, 
                 alternative = "two.sided")
U

U = wilcox_test(survival_rate~Temperature, data = week24_survival, 
                 alternative = "less")
U



kruskal.test(survival_rate ~ Diet, data = week23_survival) #not sig
kruskal.test(survival_rate ~ Diet, data = week18_survival) #not sig
kruskal.test(survival_rate ~ Diet, data = week13_survival) #not sig
kruskal.test(survival_rate ~ Diet, data = week4_survival) #not sig

kruskal.test(survival_rate ~ Treatment, data = week23_survival) #not sig
kruskal.test(survival_rate ~ Treatment, data = week18_survival) #not sig
kruskal.test(survival_rate ~ Treatment, data = week13_survival) #not sig
kruskal.test(survival_rate ~ Treatment, data = week4_survival) #not sig

kruskal.test(survival_rate ~ Treatment, data = week9_survival) 


kruskal.test(survival_rate ~ Treatment, data = week8_survival) 
#significant: 
kruskal.test(survival_rate ~ Temperature, data = week8_survival) #not sig

dunn.test(week8_survival$survival_rate, g = week8_survival$Treatment, altp = TRUE)

dunn.test(week9_survival$survival_rate, g = week9_survival$Treatment, altp = TRUE)

dunn.test(week8_survival$survival_rate, g = week8_survival$Diet, altp = TRUE)

kruskal.test(survival_rate ~ Diet, data = week9_survival) 
#significant: 

dunn.test(week9_survival$survival_rate, g = week9_survival$Diet)



survival %>% filter(Week == 23) %>% group_by(Treatment, Week) %>% summarise(survival_mean = mean(survival_rate), SGR_se = sd(survival_rate)/sqrt(length(survival_rate)))

#survival %>% filter(Diet == "kelp", Week == 9) %>% group_by(Treatment, Week) %>% summarise(morb_mean = mean(CumMorb), SGR_se = sd(CumMorb)/sqrt(length(CumMorb)))
```


Averages
```{r}
#diet
week9_survival %>% group_by(Diet) %>% summarise(mean = mean(survival_rate), SGR_se = sd(survival_rate)/sqrt(length(survival_rate)))

week24_survival %>% group_by(Diet) %>% summarise(mean = mean(survival_rate), SGR_se = sd(survival_rate)/sqrt(length(survival_rate)))

#temperature
week24_survival %>% group_by(Temperature) %>% summarise(mean = mean(survival_rate), SGR_se = sd(survival_rate)/sqrt(length(survival_rate)))
```



#SGR

Load data
```{r}
size <- read_excel("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data/parechinus_size.xlsx")


weight <- read_excel("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data/parechinus_weight.xlsx")

somatic_growth <- read_excel("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data/somatic_growth.xlsx")
```

Check normality and homoscedasticity:

Actual data values
```{r}
size0 <- size %>% filter(week == 0)
size4 <- size %>% filter(week == 4)
size8 <- size %>% filter(week == 8)
size13 <- size %>% filter(week == 13)
size18 <- size %>% filter(week == 18)
size23 <- size %>% filter(week == 23)

weight0 <- weight %>% filter(week == 0)
weight4 <- weight %>% filter(week == 4)
weight8 <- weight %>% filter(week == 8)
weight13 <- weight %>% filter(week == 13)
weight18 <- weight %>% filter(week == 18)
weight23 <- weight %>% filter(week == 23)

size0 %>% group_by(treatment) %>% summarise(size_mean = mean(diam), SGR_se = sd(diam)/sqrt(length(diam)))

weight0 %>% group_by(treatment) %>% summarise(weight_mean = mean(`weight (g)`), SGR_se = sd(`weight (g)`)/sqrt(length(`weight (g)`)))


shapiro.test(size0$diam)#not normal
shapiro.test(size4$diam) #not normal
shapiro.test(size8$diam) #not normal
shapiro.test(size13$diam) #not normal
shapiro.test(size18$diam) #not normal
shapiro.test(size23$diam) #not normal

shapiro.test(weight0$`weight (g)`)#not normal
shapiro.test(weight4$`weight (g)`) #not normal
shapiro.test(weight8$`weight (g)`) #not normal
shapiro.test(weight13$`weight (g)`) #not normal
shapiro.test(weight18$`weight (g)`) #not normal
shapiro.test(weight23$`weight (g)`) #not normal

shapiro.test(weight$`weight (g)`) #not normal
#W = 0.99001, p-value = 1.749e-13

require("car")

leveneTest(size$diam~size$treatment) #not equal p=7.913e-10 ***

leveneTest(weight$`weight (g)`~weight$treatment) #not equal p= 2.937e-07 ***

#not normal and variances not equal - so Kruskal Wallis


```

Kruskal tests for actual size & weight:
```{r}
require(dunn.test)
#size
#by treatment
kruskal.test(diam ~ treatment, data = size0) #not sig
kruskal.test(diam ~ treatment, data = size4) #not sig
kruskal.test(diam ~ treatment, data = size8) #sig * week 8 is sig

dunn.test(size8$diam , g = size8$treatment, altp = TRUE)#significant 

kruskal.test(diam ~ treatment, data = size13) #not sig
kruskal.test(diam ~ treatment, data = size18) #not sig
kruskal.test(diam ~ treatment, data = size23) #not sig

#by diet
kruskal.test(diam ~ diet, data = size0) #not sig
kruskal.test(diam ~ diet, data = size4) #not sig
kruskal.test(diam ~ diet, data = size8) #sig ** week 8 is sig

dunn.test(size8$diam , g = size8$diet, altp = TRUE)#significant 


kruskal.test(diam ~ diet, data = size13) #not sig
kruskal.test(diam ~ diet, data = size18) #not sig
kruskal.test(diam ~ diet, data = size23) #not sig

#by temperature
kruskal.test(diam ~ temperature, data = size0) #not sig
kruskal.test(diam ~ temperature, data = size4) #not sig
kruskal.test(diam ~ temperature, data = size8) #sig ** week 8 is sig
kruskal.test(diam ~ temperature, data = size13) #not sig
kruskal.test(diam ~ temperature, data = size18) #not sig
kruskal.test(diam ~ temperature, data = size23) #not sig


#weight
#by treatment
kruskal.test(`weight (g)` ~ treatment, data = weight0) #sig
kruskal.test(`weight (g)` ~ treatment, data = weight4) #sig
kruskal.test(`weight (g)` ~ treatment, data = weight8) #sig
kruskal.test(`weight (g)` ~ treatment, data = weight13) #not sig
kruskal.test(`weight (g)` ~ treatment, data = weight18) #not sig
kruskal.test(`weight (g)` ~ treatment, data = weight23) #not sig

#by diet
kruskal.test(`weight (g)` ~ diet, data = weight0) #not sig
kruskal.test(`weight (g)` ~ diet, data = weight4) #sig
kruskal.test(`weight (g)` ~ diet, data = weight8) #sig
kruskal.test(`weight (g)` ~ diet, data = weight13) #sig
kruskal.test(`weight (g)` ~ diet, data = weight18) #not sig
kruskal.test(`weight (g)` ~ diet, data = weight23) #not sig
```




SGR values at weekly intervals
Normality & Homoscedasticity tests
```{r}
require("car")

weight_SGR_prior_tests <- function(data){
  shapiro <- shapiro.test(data$`weight_specific growth rate`)
  levene1 <- leveneTest(data$`weight_specific growth rate`~data$diet)
  levene2 <- leveneTest(data$`weight_specific growth rate`~data$temperature)
  print(shapiro)
  print(levene1)
  print(levene2)
}

size_SGR_prior_tests <- function(data){
  shapiro <- shapiro.test(data$`size_specific growth rate`)
  levene1 <- leveneTest(data$`size_specific growth rate`~data$diet)
  levene2 <- leveneTest(data$`size_specific growth rate`~data$temperature)
  print(shapiro)
  print(levene1)
  print(levene2)
}

somatic_growth$temperature <- as.factor(somatic_growth$temperature)

SGR4 <- somatic_growth %>% filter(week == 4)
SGR8 <- somatic_growth %>% filter(week == 8)
SGR13 <- somatic_growth %>% filter(week == 13) %>% filter(diet != "kelp")
SGR18 <- somatic_growth %>% filter(week == 18)
SGR23 <- somatic_growth %>% filter(week == 23)

somatic_growth$week <- as.factor(somatic_growth$week)
SGRma <- somatic_growth %>% filter(treatment == "ma")
SGRmw <- somatic_growth %>% filter(treatment == "mw")
SGRua <- somatic_growth %>% filter(treatment == "ua")
SGRuw <- somatic_growth %>% filter(treatment == "uw")
SGRfa <- somatic_growth %>% filter(treatment == "fa")
SGRfw <- somatic_growth %>% filter(treatment == "fw")
SGRka <- somatic_growth %>% filter(treatment == "ka")
SGRkw <- somatic_growth %>% filter(treatment == "kw")

SGRf <- somatic_growth %>% filter(diet == "formulated")
SGRm <- somatic_growth %>% filter(diet == "mixed")
SGRk <- somatic_growth %>% filter(diet == "kelp")
SGRu <- somatic_growth %>% filter(diet == "ulva")
  
weight_SGR_prior_tests(SGR4) #normal & equal - ANOVA
weight_SGR_prior_tests(SGR8) #normal & equal - ANOVA
weight_SGR_prior_tests(SGR13) #normal & equal - ANOVA
weight_SGR_prior_tests(SGR18)#normal & equal - ANOVA
weight_SGR_prior_tests(SGR23)#normal & equal - ANOVA

weight_SGR_prior_tests(somatic_growth) #normal & NOT equal
 
size_SGR_prior_tests(SGR4)#NOT normal & equal - Kruskal Wallis
size_SGR_prior_tests(SGR8) #normal & equal - ANOVA
size_SGR_prior_tests(SGR13) #normal & equal - ANOVA
size_SGR_prior_tests(SGR18) #normal & equal - ANOVA
size_SGR_prior_tests(SGR23) #normal & equal - ANOVA

```

Tests for significance

Weight
```{r}
anova_weight_SGR <- function(dat){
aov(`weight_specific growth rate`~diet,data=dat)
}

#week 4
w_anova4<- anova_weight_SGR(SGR4)
summary(w_anova4) #diet sig


w_anova4 <- aov(`weight_specific growth rate`~diet, data = SGR4)
summary(w_anova4)
Tukey4 = TukeyHSD(w_anova4, ordered = TRUE)
Tukey4

t.test(`weight_specific growth rate`~temperature, data = SGR4, alternative = "two.sided",var.equal=T)
 
#week8

w_anova8 <- aov(`weight_specific growth rate`~diet, data = SGR8)
summary(w_anova8)


t.test(`weight_specific growth rate`~temperature, data = SGR8, alternative = "two.sided",var.equal=T)
 

#week 13
w_anova13<- anova_weight_SGR(SGR13)
summary(w_anova13) #diet & temp sig

w_anova13 <- aov(`weight_specific growth rate`~diet, data = SGR13)
summary(w_anova13)
Tukey13 = TukeyHSD(w_anova13, ordered = TRUE)
Tukey13

t.test(`weight_specific growth rate`~temperature, data = SGR13, alternative = "two.sided",var.equal=T)

t.test(`weight_specific growth rate`~temperature, data = SGR13, alternative = "greater",var.equal=T)


#week18
w_anova18<- anova_weight_SGR(SGR18)
summary(w_anova18)#diet sig temp ns

w_anova18 <- aov(`weight_specific growth rate`~diet, data = SGR18)
summary(w_anova18)
Tukey18 = TukeyHSD(w_anova18, ordered = TRUE)
Tukey18

t.test(`weight_specific growth rate`~temperature, data = SGR18, alternative = "two.sided",var.equal=T)


#week 23
w_anova23<- anova_weight_SGR(SGR23)

summary(w_anova23) #diet & temp sig

w_anova23 <- aov(`weight_specific growth rate`~diet, data = SGR23)
summary(w_anova23)
Tukey23 = TukeyHSD(w_anova23, ordered = TRUE)
Tukey23

w_anova23 <- aov(`weight_specific growth rate`~temperature, data = SGR23)
summary(w_anova23)
Tukey23 = TukeyHSD(w_anova23, ordered = TRUE)
Tukey23


t.test(`weight_specific growth rate`~temperature, data = SGR23, alternative = "two.sided", var.equal=T) #across all diets

t.test(`weight_specific growth rate`~temperature, data = SGR23[SGR23$diet == "formulated",], alternative = "less", var.equal=T) #within ulva

```

Size
```{r}
anova_size_SGR <- function(dat){
aov(`size_specific growth rate`~diet,data=dat)
}
#week 4
kruskal.test(`size_specific growth rate` ~ diet, data = SGR4) #not sig

require(coin)
U = wilcox_test(`size_specific growth rate` ~temperature, data = SGR4, 
                 alternative = "two.sided")
U

U = wilcox_test(`size_specific growth rate` ~temperature, data = SGR4, 
                 alternative = "greater")
U

kruskal.test(`size_specific growth rate` ~ temperature, data = SGR4) #sig

require(dunn.test)
dunn.test(SGR4$`size_specific growth rate` , g = SGR4$treatment, altp = TRUE)#significant differences found but the overall p-value is not significant so i have not added these groupings to the bar plot

dunn.test(SGR4$`size_specific growth rate` , g = SGR4$diet, altp = TRUE, method = "bonferroni")
#sig


#week 8
s_anova8<- anova_size_SGR(SGR8)
summary(s_anova8) #not sig

t.test(`size_specific growth rate`~temperature, data = SGR8, alternative = "two.sided",var.equal=T)


s_anova8<- aov(`size_specific growth rate`~temperature,data=SGR8)
summary(s_anova8) #not sig

s_anova8<- aov(`size_specific growth rate`~diet,data=SGR8)
summary(s_anova8) #not sig

t.test(`size_specific growth rate`~temperature, data = SGR8, alternative = "greater", var.equal=T)


#week 13
s_anova13<- anova_size_SGR(SGR13)
summary(s_anova13) #diet sig

s_anova13<- aov(`size_specific growth rate`~diet, data = SGR13)
summary(s_anova13)
Tukey13 = TukeyHSD(s_anova13, ordered = TRUE)
Tukey13

t.test(`size_specific growth rate`~temperature, data = SGR13, alternative = "two.sided", var.equal=T)

#week18
s_anova18<- anova_size_SGR(SGR18)
summary(s_anova18) #diet sig

s_anova18<- aov(`size_specific growth rate`~diet, data = SGR18)
summary(s_anova18)
Tukey18 = TukeyHSD(s_anova18, ordered = TRUE)
Tukey18

t.test(`size_specific growth rate`~temperature, data = SGR18, alternative = "two.sided", var.equal=T)

#week23
s_anova23<- anova_size_SGR(SGR23)
summary(s_anova23) #temp sig, diet ns, treatment ns

t.test(`size_specific growth rate`~temperature, data = SGR23, alternative = "two.sided", var.equal=T)


t.test(`size_specific growth rate`~temperature, data = SGR23, alternative = "greater", var.equal=T)

s_anova23<- aov(`size_specific growth rate`~temperature, data = SGR23)
summary(s_anova23)
Tukey23 = TukeyHSD(s_anova23, ordered = TRUE)
Tukey23

s_anova23<- aov(`size_specific growth rate`~diet, data = SGR23)
summary(s_anova23)
Tukey23 = TukeyHSD(s_anova23, ordered = TRUE)
Tukey23


```



Averages
Weight
```{r}
#DIET
SGR4 %>% group_by(diet) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))

SGR8 %>% group_by(diet) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))


SGR13 %>% group_by(diet) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))


SGR18 %>% group_by(diet) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))

SGR23 %>% group_by(diet) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))


#temperature
SGR4 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))

SGR8 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))


SGR13 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))


SGR18 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))

SGR23 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`weight_specific growth rate`), SGR_se = sd(`weight_specific growth rate`)/sqrt(length(`weight_specific growth rate`)))
```
SIZE 
```{r}
#BY DIET
SGR4 %>% group_by(diet) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR8 %>% group_by(diet) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR13 %>% group_by(diet) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR18 %>% group_by(diet) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR23 %>% group_by(diet) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))


SGR23 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

#BY temperature
SGR4 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR8 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR13 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR18 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))

SGR23 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))


SGR23 %>% group_by(temperature) %>% summarise(SGR_mean = mean(`size_specific growth rate`), SGR_se = sd(`size_specific growth rate`)/sqrt(length(`size_specific growth rate`)))
```






Looking within treatments over time
```{r}
require(car)

somatic_growth$week <- as.factor(somatic_growth$week)
SGRma <- somatic_growth %>% filter(treatment == "ma")
SGRmw <- somatic_growth %>% filter(treatment == "mw")
SGRua <- somatic_growth %>% filter(treatment == "ua")
SGRuw <- somatic_growth %>% filter(treatment == "uw")
SGRfa <- somatic_growth %>% filter(treatment == "fa")
SGRfw <- somatic_growth %>% filter(treatment == "fw")
SGRka <- somatic_growth %>% filter(treatment == "ka")
SGRkw <- somatic_growth %>% filter(treatment == "kw")
  
weight_SGR_prior_tests_ot <- function(data){
  shapiro <- shapiro.test(data$`weight_specific growth rate`)
  levene <- leveneTest(data$`weight_specific growth rate`~data$week)
  bartlett<- bartlett.test(data$`weight_specific growth rate`~data$week)
  print(shapiro)
  print(levene)
  print(bartlett)
}

size_SGR_prior_tests_ot <- function(data){
  shapiro <- shapiro.test(data$`size_specific growth rate`)
  levene <- leveneTest(data$`size_specific growth rate`~data$week)
  bartlett<- bartlett.test(data$`size_specific growth rate`~data$week)
  print(shapiro)
  print(levene)
  print(bartlett)
}


weight_SGR_prior_tests_ot(SGRma)#normal & equal - ANOVA
weight_SGR_prior_tests_ot(SGRmw) #normal & equal - ANOVA
weight_SGR_prior_tests_ot(SGRuw) #normal & equal - ANOVA
weight_SGR_prior_tests_ot(SGRua) #normal & equal - ANOVA
weight_SGR_prior_tests_ot(SGRfa) #normal & equal - ANOVA
weight_SGR_prior_tests_ot(SGRfw) #normal & equal - ANOVA
weight_SGR_prior_tests_ot(SGRka) #not normal & not equal (Bartlett equal) - Kruskal Wallis
weight_SGR_prior_tests_ot(SGRkw) #normal and equal - ANOVA

size_SGR_prior_tests_ot(SGRma)#normal & equal - ANOVA
size_SGR_prior_tests_ot(SGRmw) #normal & equal - ANOVA
size_SGR_prior_tests_ot(SGRuw) #normal & not equal (Bartlett equal) - Welch ANOVA
size_SGR_prior_tests_ot(SGRua) #normal & equal - ANOVA
size_SGR_prior_tests_ot(SGRfa) #not normal & not equal - Kruskal Wallis
size_SGR_prior_tests_ot(SGRfw) #normal & equal - ANOVA
size_SGR_prior_tests_ot(SGRka) #normal & equal - ANOVA
size_SGR_prior_tests_ot(SGRkw) #normal & equal - ANOVA


```






```{r}

SGR48 <- SGR4 %>% bind_rows(SGR8)
SGR813 <- SGR8 %>% bind_rows(SGR13)



require("dunn.test")
#install.packages("coin", dependencies = TRUE)
require(coin)

#WEIGHT

anova_weight_SGR <- function(dat){
aov(`weight_specific growth rate`~week,data=dat)
}

t.test(`weight_specific growth rate`~week, data = SGRka, alternative = "less", var.equal=F)

kruskal_test(`weight_specific growth rate`~week, data = SGRka)

kw_anova<- anova_weight_SGR(SGRkw)
summary(kw_anova) #significant

t.test(`weight_specific growth rate`~week, data = SGRkw, alternative = "less", var.equal=T)

t.test(`weight_specific growth rate`~week, data = SGR48[SGR48$treatment=="kw",],alternative = "less", var.equal=T)


#SIZE
anova_size_SGR <- function(dat){
aov(`size_specific growth rate`~week,data=dat)
}


ka_anova<- anova_size_SGR(SGRka)
summary(ka_anova) #no significant differences

kw_anova<- anova_size_SGR(SGRkw)
summary(kw_anova) #no significant differences

ma_anova<- anova_size_SGR(SGRma)
summary(ma_anova) #significant - continue to Tukey

mw_anova<- anova_size_SGR(SGRmw)
summary(mw_anova) #significant - continue to Tukey

kruskal.test(`size_specific growth rate` ~ week, data = SGRfa)
#significant - continue to Dunn

fw_anova<- anova_size_SGR(SGRfw)
summary(fw_anova) #not significant

ua_anova<- anova_size_SGR(SGRua)
summary(ua_anova) #not significant


uw_anova<- anova_size_SGR(SGRuw)
summary(uw_anova) #not significant

Tukeyma = TukeyHSD(ma_anova, ordered = TRUE)
Tukeyma

Tukeymw = TukeyHSD(mw_anova, ordered = TRUE)
Tukeymw


kruskal.test(survival_rate ~ Treatment, data = week8_survival) 
#significant: Kruskal-Wallis chi-squared = 18.163, df = 7, p-value = 0.01126

dunn.test(SGRfa$`size_specific growth rate` , g = SGRfa$week)


t.test(`size_specific growth rate`~week, data = SGR813[SGR813$treatment=="ma",],alternative = "less", var.equal=T)






anova_weight_SGR <- function(dat){
aov(`weight_specific growth rate`~week,data=dat)
}

ka_anova<- anova_weight_SGR(SGRka)
summary(ka_anova) #no significant differences

kw_anova<- anova_weight_SGR(SGRkw)
summary(kw_anova) #significant - continue to Tukey

ma_anova<- anova_size_SGR(SGRma)
summary(ma_anova) #significant - continue to Tukey

mw_anova<- anova_size_SGR(SGRmw)
summary(mw_anova) #significant - continue to Tukey

fa_anova<- anova_size_SGR(SGRfa)
summary(fa_anova) #not significant

fw_anova<- anova_size_SGR(SGRfw)
summary(fw_anova) #not significant

ua_anova<- anova_size_SGR(SGRua)
summary(ua_anova) #not significant

uw_anova<- anova_size_SGR(SGRuw)
summary(uw_anova) #not significant
```



#GSI

Load data
```{r}
gonad <- read_excel("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data/gonad.xlsx")

gonad9 <- gonad %>% filter(week == 9)
gonad19 <- gonad %>% filter(week == 19)
gonad26 <- gonad %>% filter(week == 26)


```

Normality & Homoscedasticity
```{r}
require(car)

GSI_prior_tests <- function(data){
  shapiro <- shapiro.test(data$GSI)
  levene <- leveneTest(data$GSI~data$treatment)
  print(shapiro)
  print(levene)
}

GSI_prior_tests(gonad9) #not normal, equal variance - Kruskal
shapiro.test(log(gonad9$GSI)) #log GSI normal, equal variance - ANOVA
gonad9$logGSI <- log(gonad9$GSI)
GSI_prior_tests(gonad19) #normal, equal variance - ANOVA
GSI_prior_tests(gonad26) #normal, equal variance - ANOVA


```
Significance tests
```{r}


library(dunn.test)
require("dunn.test")
#install.packages("coin", dependencies = TRUE)
require(coin)

#week 9
kruskal.test(GSI ~ diet, data = gonad9) #diet significant
kruskal.test(GSI ~ temperature, data = gonad9) #temp not significant
kruskal.test(GSI ~ treatment, data = gonad9) #treatment significant

dunn.test(gonad9$GSI, g = gonad9$diet, altp = TRUE)
dunn.test(gonad9$GSI, g = gonad9$treatment, altp = TRUE)


#week 19
kruskal.test(GSI ~ diet, data = gonad19) #diet significant
kruskal.test(GSI ~ temperature, data = gonad19) #temp not significant
kruskal.test(GSI ~ treatment, data = gonad19) #treatment significant

dunn.test(gonad19$GSI, g = gonad19$diet, altp = TRUE)
dunn.test(gonad19$GSI, g = gonad19$treatment, altp = TRUE)

#week 26
kruskal.test(GSI ~ diet, data = gonad26) #diet significant
kruskal.test(GSI ~ temperature, data = gonad26) #temp not significant
kruskal.test(GSI ~ treatment, data = gonad26) #treatment significant

dunn.test(gonad26$GSI, g = gonad26$diet, altp = TRUE)
dunn.test(gonad26$GSI, g = gonad26$treatment, altp = TRUE)


dunn.test(gonad9$GSI, g = gonad9$treatment)

dunn.test(week8_survival$survival_rate, g = week8_survival$Treatment)
```

ANOVA for dietary effects
```{r}
anova_GSI <- function(dat){
aov(GSI~diet,data=dat)
}

anova9 <- aov(gonad9$logGSI~gonad9$diet)
summary(anova9)
Tukey9 = TukeyHSD(anova9, ordered = TRUE)
Tukey9

anova19 <- anova_GSI(gonad19)
summary(anova19)

Tukey19 = TukeyHSD(anova19, ordered=TRUE) 
Tukey19

anova26 <- anova_GSI(gonad26)
summary(anova26)

Tukey26 = TukeyHSD(anova26, ordered=TRUE) 
Tukey26
```

T-tests for temperature effects
```{r}
t.test(GSI~temperature, data = gonad9, var.equal=T)
t.test(GSI~temperature, data = gonad19, var.equal=T)
t.test(GSI~temperature, data = gonad26, var.equal=T)
```


#Gonad stage
```{r}
gonad_stage <- read_excel("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data/gonad_stage_MBH.xlsx")

gonad_stage <- gonad_stage %>% mutate(stage_nr = ifelse(stage == "recovery",1,ifelse(stage == "growing", 2, ifelse(stage == "premature",3,ifelse(stage == "mature", 4, ifelse(stage == "partly spent", 5,6))))))

gonad_stage$temperature <- as.factor(gonad_stage$temperature)

gonad9 <- gonad_stage %>% filter(week == 9)
gonad19 <- gonad_stage %>% filter(week == 19)
gonad26 <- gonad_stage %>% filter(week == 26)

```

Normality tests
```{r}
require(car)
#week 9
shapiro.test(sqrt(gonad9$stage_nr)) #not normal - log also not normal
leveneTest(gonad9$stage_nr~gonad9$diet) # equal variance

#week 19
shapiro.test(sqrt(gonad19$stage_nr)) #not normal - log also not normal
leveneTest(gonad19$stage_nr~gonad19$diet) # equal variance

#week 26
shapiro.test(gonad26$stage_nr) #not normal - log also not normal
leveneTest(gonad26$stage_nr~gonad26$diet) # equal variance

#so Kruskal for all!
```

Testing significance
```{r}
require(coin)

#diet
kruskal.test(stage_nr ~ diet, data = gonad9)
kruskal.test(stage_nr ~ diet, data = gonad19)
kruskal.test(stage_nr ~ diet, data = gonad26)

#temp
U = wilcox_test(stage_nr ~temperature, data = gonad9, 
                 alternative = "two.sided")
U

U = wilcox_test(stage_nr ~temperature, data = gonad19, 
                 alternative = "two.sided")
U

U = wilcox_test(stage_nr ~temperature, data = gonad26, 
                 alternative = "two.sided")
U

```
Post hoc tests
Diet
```{r}
require("dunn.test")
dunn.test(gonad9$stage_nr, g = gonad9$diet, altp = TRUE)
dunn.test(gonad19$stage_nr, g = gonad19$diet, altp = TRUE)
dunn.test(gonad26$stage_nr, g = gonad26$diet, altp = TRUE)
```



#Temperature
```{r}
temperature <- read_excel("C:/Users/aimee/OneDrive - University of Cape Town/OneDrive - University of Cape Town/msc_thesis/parechinus/data/temperature.xlsx")

#install.packages("moments")
library(moments)


daily_temp <- temperature %>% group_by(Date, Treatment, Period) %>% 
  summarise(daytemp = mean(`Temp °C` ),
            se = sd(`Temp °C`)/sqrt(length(`Temp °C`)))


#transformation
transformation <- daily_temp %>% group_by(Treatment) %>% mutate(daytemp_trans = log10(max(daytemp+1) - daytemp), daytemp_log = log(daytemp))

#seperate into periods
t1<- transformation %>% filter(Period == 1)
t2<- transformation %>% filter(Period == 2)
t3<- transformation %>% filter(Period == 3)
t4<- transformation %>% filter(Period == 4)
t5<- transformation %>% filter(Period == 5)


#seperate into treatments
a_temp <- transformation %>% filter(Treatment == "Ambient")
w_temp <- transformation %>% filter(Treatment == "Warmed")


temp_normality <- function(data){
  print(shapiro.test(data$daytemp))
  print(shapiro.test(data$daytemp_trans))
  print(shapiro.test(data$daytemp_log))
}


#period 1 - ambient normal, warm not normal
t1 %>% filter(Treatment == "Ambient") %>% temp_normality()
t1 %>% filter(Treatment == "Warmed") %>% temp_normality()

#period 2 - ambient normal, warm normal
t2 %>% filter(Treatment == "Ambient") %>% temp_normality()
t2 %>% filter(Treatment == "Warmed") %>% temp_normality()

#period 3 - ambient normal, warm normal
t3 %>% filter(Treatment == "Ambient") %>% temp_normality()
t3 %>% filter(Treatment == "Warmed") %>% temp_normality()

#period 4 - ambient trans normal, warm not normal
t4 %>% filter(Treatment == "Ambient") %>% temp_normality()
t4 %>% filter(Treatment == "Warmed") %>% temp_normality()

#period 5 - ambient normal, warm not normal
t5 %>% filter(Treatment == "Ambient") %>% temp_normality()
t5 %>% filter(Treatment == "Warmed") %>% temp_normality()


```

Look at ambient between periods
```{r}
winter <- bind_rows(t1,t2)
spring <- bind_rows(t4,t5)

winter %>% ggplot(aes(x = daytemp, color = Treatment))+geom_histogram()
spring %>% ggplot(aes(x = daytemp, color = Treatment))+geom_histogram()
```

